# RepaintTem: 交互式图像重绘与装饰演示程序

## 项目概述

RepaintTem是一个基于PyQt5的交互式图像编辑应用程序，主要针对室内设计和墙面装饰场景。该程序允许用户通过简单的点击操作，实现以下三种功能：

1. **画作替换**：将指定图像（如艺术画）透视映射到墙面上的选定区域
2. **墙面重新着色**：选择墙面部分并应用新的颜色，同时保留原有的光照效果和纹理细节
3. **壁纸更换**：将壁纸纹理应用到墙面上的选定区域

## 功能特点

- **直观的用户界面**：简洁的图形界面，支持鼠标点击交互
- **自定义图像处理算法**：手动实现高斯模糊和透视变换算法
- **智能颜色调整**：在更改颜色时保持原始光照结构
- **平滑混合效果**：所有变换都使用渐变边缘，确保效果自然
- **RGB颜色预设**：内置多种墙面颜色预设选项

## 技术亮点

1. **手动实现的高斯模糊算法**：不依赖OpenCV的高级功能，自己编写卷积操作
2. **手动实现的透视变换**：采用逆映射和双线性插值实现专业级透视效果
3. **灰度结构保留着色**：在重新着色时保留原图的明暗结构
4. **区域与Flood Fill结合**：利用多边形区域和种子填充的组合实现精确选择

## 安装依赖

本程序需要以下Python库：

```bash
pip install numpy opencv-python PyQt5
```

## 使用方法

1. 准备三个图片文件并放在程序同一目录下：
   - `test2.jpg`：原始室内场景图片
   - `painting.jpg`：用于替换的画作图片
   - `wallpaper.jpg`：用于应用的壁纸纹理图片

2. 运行程序：
   ```bash
   python repaint_tem.py
   ```

3. 选择操作模式：
   - **Replace Painting**：替换画作
   - **Recolour Wall**：重新着色墙面
   - **Change Wallpaper**：更换壁纸

4. 根据所选模式执行相应操作：
   - **画作替换模式**：按顺序点击目标区域的4个角点（顺时针），然后点击"APPLY"按钮
   - **墙面着色模式**：点击墙面上的一个点作为种子点，选择颜色预设，然后点击"APPLY"按钮
   - **壁纸更换模式**：先点击4个角点定义区域，再点击区域内部一点作为种子点，然后点击"APPLY"按钮

5. 使用"RESET"按钮恢复到原始图像

## 工作原理

### 画作替换

1. 用户点击定义目标四边形的4个角点
2. 系统计算透视变换矩阵
3. 应用透视变换将画作映射到目标区域
4. 创建多边形掩码并将变换后的画作替换到原图对应区域

### 墙面重新着色

1. 用户点击墙面上的一个点作为种子点
2. 系统使用FloodFill算法识别相似颜色区域
3. 对掩码应用高斯模糊创建平滑过渡
4. 将原图转为灰度并保留明暗结构
5. 将选择的新颜色与灰度结构相乘，实现保留纹理的着色
6. 混合新颜色区域和原图

### 壁纸应用

1. 用户点击定义目标区域的4个角点
2. 用户点击区域内部一点作为种子点
3. 系统结合多边形区域和种子点填充，精确识别目标区域
4. 对掩码应用高斯模糊创建平滑过渡
5. 将壁纸进行透视变换并与原图混合

## 自定义实现的算法

### 1. 高斯模糊 (Gaussian Blur)

程序手动实现了高斯模糊算法，包括：
- 生成二维高斯核函数
- 使用二维卷积运算应用该核到图像
- 边缘处理使用反射填充

### 2. 透视变换 (Perspective Warp)

程序手动实现了透视变换算法，包括：
- 计算逆变换矩阵
- 使用逆向映射方法
- 实现双线性插值确保平滑像素值

### 3. 保留结构的着色技术

在重新着色时，程序保留了原始图像的结构信息：
- 将RGB图像转换为灰度
- 归一化灰度值作为亮度结构
- 将新颜色乘以该结构，保留明暗变化

## 注意事项

- 确保预设的三个图像文件位于程序同一目录下
- 最佳效果需要清晰的边界和适当的光照条件
- 墙面重新着色效果与种子点选择位置有关
- 壁纸应用需要选择明确的区域边界

## 可能的扩展

- 添加更多颜色选择选项
- 支持加载自定义图像和纹理
- 实现撤销/重做功能
- 添加更多图像处理滤镜
- 支持保存处理后的图像

## 作者

本演示程序通过实现多种手动图像处理算法，展示了计算机视觉和图像处理的核心概念。程序适合作为教学工具，介绍透视变换、颜色调整和区域选择等技术的实现原理。